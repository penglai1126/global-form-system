<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据展示页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .data-card {
            background: #f9f9f9;
            border-left: 4px solid #007cba;
            padding: 15px;
            margin-bottom: 20px;
        }
        .download-btn {
            background-color: #28a745;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            display: block;
            width: 100%;
            margin-top: 20px;
        }
        .download-btn:hover {
            background-color: #218838;
        }
        .field {
            margin-bottom: 10px;
        }
        .field-label {
            font-weight: bold;
            color: #333;
        }
        .field-value {
            color: #666;
        }
    </style>
</head>
<body>
    <h1>表单数据展示</h1>
    <div id="dataDisplay" class="data-card">
        <!-- 数据将在这里动态显示 -->
        <p>正在加载数据...</p>
    </div>
    
    <button id="downloadBtn" class="download-btn">一键下载数据</button>
    
    <script>
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 获取URL参数中的Base64数据
            const urlParams = new URLSearchParams(window.location.search);
            const base64Data = urlParams.get('data');
            
            // 显示数据的容器
            const dataDisplay = document.getElementById('dataDisplay');
            
            if (base64Data) {
                try {
                    // 解码Base64数据
                    const jsonString = decodeURIComponent(escape(atob(base64Data)));
                    
                    // 解析JSON数据
                    const formData = JSON.parse(jsonString);
                    
                    // 构建HTML显示数据
                    let displayHTML = '';
                    displayHTML += `<div class="field"><span class="field-label">姓名:</span> <span class="field-value">${escapeHtml(formData.name)}</span></div>`;
                    displayHTML += `<div class="field"><span class="field-label">邮箱:</span> <span class="field-value">${escapeHtml(formData.email)}</span></div>`;
                    displayHTML += `<div class="field"><span class="field-label">公司:</span> <span class="field-value">${escapeHtml(formData.company)}</span></div>`;
                    displayHTML += `<div class="field"><span class="field-label">职位:</span> <span class="field-value">${escapeHtml(formData.position)}</span></div>`;
                    displayHTML += `<div class="field"><span class="field-label">备注:</span> <span class="field-value">${escapeHtml(formData.comments)}</span></div>`;
                    displayHTML += `<div class="field"><span class="field-label">提交时间:</span> <span class="field-value">${new Date(formData.timestamp).toLocaleString('zh-CN')}</span></div>`;
                    
                    // 更新显示内容
                    dataDisplay.innerHTML = displayHTML;
                    
                    // 设置下载功能
                    document.getElementById('downloadBtn').addEventListener('click', function() {
                        downloadData(formData);
                    });
                    
                } catch (error) {
                    // 数据处理出错时显示错误信息
                    dataDisplay.innerHTML = '<p>数据解析错误，请检查URL是否正确。</p>';
                    console.error('数据解析错误:', error);
                }
            } else {
                // 没有数据参数时显示提示
                dataDisplay.innerHTML = '<p>未找到表单数据，请从表单页面提交数据。</p>';
            }
        });
        
        // HTML转义函数，防止XSS攻击
        function escapeHtml(unsafe) {
            if (unsafe === null || unsafe === undefined) return '';
            return unsafe
                .toString()
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
        
        // 下载数据函数
        function downloadData(data) {
            // 创建数据Blob
            const jsonData = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            
            // 创建下载链接
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            
            // 生成文件名（包含时间戳）
            const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            a.download = `form-data-${timestamp}.json`;
            
            // 触发下载
            document.body.appendChild(a);
            a.click();
            
            // 清理
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
        }
    </script>
</body>
</html>
